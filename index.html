<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾¦å…¬å®¤å·¡æª¢æ‰“å¡</title>
    <style>
        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            padding: 20px; 
            text-align: center; 
            background-color: #f0f2f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 0 auto;
        }
        h2 { color: #333; margin-bottom: 10px; }
        p { color: #666; }
        
        .status { 
            margin: 20px 0; 
            padding: 15px; 
            border-radius: 8px;
            background: #e9ecef; 
            font-size: 16px;
            line-height: 1.6;
            text-align: left;
        }
        
        button { 
            width: 100%;
            padding: 15px; 
            font-size: 18px; 
            font-weight: bold;
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: background 0.3s;
        }
        button:active { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        .success { color: #28a745; font-weight: bold; font-size: 1.2em; display: block; text-align: center; margin-top: 10px;}
        .fail { color: #dc3545; font-weight: bold; font-size: 1.2em; display: block; text-align: center; margin-top: 10px;}
        
        .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px solid #ddd; padding-bottom: 5px;}
        .info-label { color: #777; }
        .info-val { font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ“ è¾¦å…¬å®¤å·¡æª¢ç³»çµ±</h2>
        <p>è«‹æŠµé”æŒ‡å®šä½ç½®å¾Œï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•é€²è¡Œæ‰“å¡ç¢ºèªã€‚</p>
        
        <div id="result" class="status">
            <div style="text-align:center; color:#888;">ç­‰å¾…æ“ä½œ...</div>
        </div>
        
        <button id="checkBtn" onclick="checkLocation()">ğŸ“ æˆ‘å·²æŠµé”ï¼Œé–‹å§‹æ‰“å¡</button>
    </div>

    <script>
        // ==========================================
        // ğŸ“ è¨­å®šå€ (æ‚¨å‰›å‰›æ¡æ¨£çš„åº§æ¨™)
        // ==========================================
        const TARGET_LAT = 24.73529; 
        const TARGET_LNG = 121.75624;
        
        // å…è¨±çš„èª¤å·®ç¯„åœ (å–®ä½ï¼šå…¬å°º)
        // è¾¦å…¬å®¤å®¤å…§è¨Šè™Ÿå¯èƒ½é£„ç§»ï¼Œå»ºè­°è¨­ 50-80 å…¬å°ºæ¯”è¼ƒå¥½é€šé
        const ALLOWED_DISTANCE = 60; 
        // ==========================================

        function checkLocation() {
            const resultDiv = document.getElementById("result");
            const btn = document.getElementById("checkBtn");

            if (!navigator.geolocation) {
                resultDiv.innerHTML = "æ‚¨çš„è£ç½®ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚";
                return;
            }

            resultDiv.innerHTML = '<div style="text-align:center;">ğŸ“¡ æ­£åœ¨è¡›æ˜Ÿå®šä½ä¸­...<br><small>è«‹ç¨å€™ç´„ 3-5 ç§’</small></div>';
            btn.disabled = true;

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const currentLat = position.coords.latitude;
                    const currentLng = position.coords.longitude;
                    const accuracy = position.coords.accuracy; // æ‰‹æ©Ÿ GPS çš„ç²¾ç¢ºåº¦åŠå¾‘

                    // è¨ˆç®—èˆ‡ç›®æ¨™çš„è·é›¢
                    const distance = getDistanceFromLatLonInM(currentLat, currentLng, TARGET_LAT, TARGET_LNG);

                    // é¡¯ç¤ºè©³ç´°è³‡è¨Š
                    let htmlContent = `
                        <div class="info-row"><span class="info-label">ç›®æ¨™è·é›¢</span> <span class="info-val">${distance.toFixed(1)} å…¬å°º</span></div>
                        <div class="info-row"><span class="info-label">GPS èª¤å·®</span> <span class="info-val">Â±${accuracy.toFixed(1)} å…¬å°º</span></div>
                    `;

                    // åˆ¤æ–·æ˜¯å¦åˆæ ¼
                    // é‚è¼¯ï¼šè·é›¢è¦å°æ–¼å…è¨±å€¼
                    if (distance <= ALLOWED_DISTANCE) {
                        htmlContent += `<span class="success">âœ… æ‰“å¡æˆåŠŸï¼</span>`;
                        htmlContent += `<div style="text-align:center; font-size:14px; color:#28a745; margin-top:5px;">æ‚¨å·²åœ¨æŒ‡å®šç¯„åœå…§</div>`;
                    } else {
                        htmlContent += `<span class="fail">âŒ æ‰“å¡å¤±æ•—</span>`;
                        htmlContent += `<div style="text-align:center; font-size:14px; color:#dc3545; margin-top:5px;">æ‚¨è·é›¢ç›®æ¨™å¤ªé ï¼Œè«‹é è¿‘å¾Œé‡è©¦ã€‚</div>`;
                    }

                    resultDiv.innerHTML = htmlContent;
                    btn.disabled = false;
                },
                (error) => {
                    let errorMsg = "å®šä½å¤±æ•—";
                    if (error.code === 1) errorMsg = "è«‹å…è¨±ç€è¦½å™¨å­˜å–ä½ç½®æ¬Šé™";
                    else if (error.code === 2) errorMsg = "GPS è¨Šè™Ÿå¾®å¼± (è«‹é è¿‘çª—æˆ¶æˆ–èµ°åˆ°æˆ¶å¤–)";
                    else if (error.code === 3) errorMsg = "å®šä½è«‹æ±‚è¶…æ™‚";
                    
                    resultDiv.innerHTML = `<div style="text-align:center; color:red;">âš ï¸ ${errorMsg}</div>`;
                    btn.disabled = false;
                },
                {
                    enableHighAccuracy: true, 
                    timeout: 10000,          
                    maximumAge: 0            
                }
            );
        }

        // è¨ˆç®—è·é›¢å…¬å¼ (Haversine)
        function getDistanceFromLatLonInM(lat1, lon1, lat2, lon2) {
            var R = 6371000; 
            var dLat = deg2rad(lat2 - lat1);
            var dLon = deg2rad(lon2 - lon1);
            var a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }
    </script>
</body>
</html>